local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = game.Players.LocalPlayer
local gameValues = ReplicatedStorage:WaitForChild("GameValues")
local warmupFinished = gameValues:WaitForChild("WarmupFinished")
local VirtualUser = game:GetService('VirtualUser')
local StarterGui = game:GetService('StarterGui')
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

StarterGui:SetCore("SendNotification", { Title = "XP SCRIPT | BADGEPLUG |", Text = "| ACTIVATED |", Duration = 5 })

player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

local function disableAFKCheck()
    local function disableScriptInGui(gui)
        local afkCheckScript = gui:FindFirstChild("AFK.Check")
        if afkCheckScript and afkCheckScript:IsA("LocalScript") then
            afkCheckScript.Disabled = true
        end
    end
    local starterGuiAFKUi = StarterGui:FindFirstChild("AFK.Ui")
    if starterGuiAFKUi then
        disableScriptInGui(starterGuiAFKUi)
    end
    local playerGuiAFKUi = player.PlayerGui:FindFirstChild("AFK.Ui")
    if playerGuiAFKUi then
        disableScriptInGui(playerGuiAFKUi)
    end
end

disableAFKCheck()

local humanoidsFolder = workspace:FindFirstChild("Humanoids")
local character = humanoidsFolder and humanoidsFolder:FindFirstChild(player.Name)
if not character then
    character = player.Character or player.CharacterAdded:Wait()
end

local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local function AutoShoot()
    pcall(function()
        local args = {true, "Shooting", "Standing Shot"}
        local event = ReplicatedStorage:WaitForChild("PlayerEvents"):WaitForChild("Shooting")
        local actionValues = player.Backpack:WaitForChild("ActionValues", 5)
        local powerValue = actionValues and actionValues:WaitForChild("Power", 2)
        local gameplayAnimations = player.Backpack:WaitForChild("GameplayAnimations", 5)
        local shootingAnimations = gameplayAnimations and gameplayAnimations:WaitForChild("ShootingAnimations", 2)
        local animation = shootingAnimations and shootingAnimations:FindFirstChild("Jumpshot")
        local connection
        if powerValue then
            connection = RunService.Heartbeat:Connect(function()
                powerValue.Value = 1
            end)
        end
        if animation and humanoid then
            local animator = humanoid:FindFirstChildOfClass("Animator")
            if animator then
                local animTrack = animator:LoadAnimation(animation)
                animTrack:Play()
            end
        end
        if event then
            for i = 1, 1000000 do
                event:FireServer(unpack(args))
                task.wait()
            end
        end
        if connection then
            connection:Disconnect()
        end
    end)
end

local function walkToNearestBall()
    local nearestBall = nil
    local minDistance = math.huge
    local ballsFolder = workspace:FindFirstChild("Balls")
    if ballsFolder then
        for _, ball in pairs(ballsFolder:GetChildren()) do
            if ball.Name == "Ball" and ball:IsA("BasePart") then
                local distance = (ball.Position - character.HumanoidRootPart.Position).magnitude
                if distance < minDistance then
                    nearestBall = ball
                    minDistance = distance
                end
            end
        end
    end
    if nearestBall then
        humanoid:MoveTo(nearestBall.Position)
        humanoid.MoveToFinished:Wait()
        wait(2)
        AutoShoot()
    end
end

local function moveToPositionAfterInterval()
    while true do
        if warmupFinished.Value == true then
            wait(90)
            local originalPosition = Vector3.new(-13.00, 3.34, -420.29)
            humanoid:MoveTo(originalPosition)
            humanoid.MoveToFinished:Wait()
        end
        wait(1)
    end
end

warmupFinished:GetPropertyChangedSignal("Value"):Connect(function()
    if warmupFinished.Value == true then
        moveToPositionAfterInterval()
    end
end)

RunService.Heartbeat:Connect(function()
    local x2Event = ReplicatedStorage:FindFirstChild("X2Event")
    if x2Event then
        x2Event.Value = true
    end
    local expMultiplier = ReplicatedStorage:FindFirstChild("RECSettings") and ReplicatedStorage.RECSettings:FindFirstChild("EXP_Multiplier")
    if expMultiplier and expMultiplier:IsA("IntValue") then
        expMultiplier.Value = 10000
    end
end)

local canRun = true
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.T and warmupFinished.Value == false and canRun then
        canRun = false
        walkToNearestBall()
        task.delay(5, function()
            canRun = true
        end)
    end
end)
